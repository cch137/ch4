"use strict";(()=>{let e=e=>JSON.parse(new TextDecoder().decode(e.reverse().map(e=>255&~e))),r=e=>new TextEncoder().encode(JSON.stringify(e)).map(e=>255&~e).reverse(),s=(e,t={})=>{if(i.readyState!==i.OPEN){let n=()=>{s(e,t),i.removeEventListener("open",n)};i[a]("open",n);return}i.send(r({...t,type:e}))},t=()=>{let e=location.href;o=e,s("view",{href:e,focus:f()})},a="addEventListener",n=()=>localStorage.getItem("t")||"",c=e=>localStorage.setItem("t",e),f=()=>document.hasFocus(),o="",i,d=(r=!1)=>{if(!r&&!f()){setTimeout(d,1e3);return}(i=new WebSocket(`wss://space.cch137.link/1/${n()}`))[a]("message",async r=>{let{cmd:s,...a}=e(new Uint8Array(await r.data.arrayBuffer()));switch(s){case"uid":c(a.uid);break;case"conn":{t();let n=setInterval(()=>{if(i.readyState!==i.OPEN)return clearInterval(n);o!==location.href?t():i.send(new Uint8Array([0]))},5e3);break}case"v-err":location.reload()}}),i[a]("error",e=>{console.error(e),i.close()}),i[a]("close",()=>{setTimeout(d,1e3)})};window[a]("blur",()=>s("blur")),window[a]("focus",()=>s("focus")),d(!0)})();